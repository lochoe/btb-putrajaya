<!DOCTYPE html>
<html lang="ms">
  <head>
    <!--
      File: index.html
      Purpose: Frontend statik untuk paparkan & filter senarai pemain BTB Putrajaya (GitHub Pages).
      Data source: Google Sheets (BTB Pendaftaran 2025) via gviz JSON API (publish to web).
    -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>BTB Putrajaya - Senarai Pemain 2025</title>
    <style>
      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        margin: 0;
        padding: 16px;
        background-color: #f3f4f6;
        color: #111827;
      }

      .page {
        max-width: 1100px;
        margin: 0 auto;
      }

      .header {
        margin-bottom: 16px;
      }

      .title {
        font-size: 1.75rem;
        font-weight: 700;
        margin: 0;
      }

      .subtitle {
        font-size: 0.9rem;
        color: #6b7280;
        margin: 4px 0 0;
      }

      .filters {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        padding: 12px;
        margin-bottom: 16px;
        background-color: #ffffff;
        border-radius: 12px;
        box-shadow: 0 1px 3px rgba(15, 23, 42, 0.08);
      }

      .filter-group {
        display: flex;
        flex-direction: column;
        gap: 4px;
        min-width: 140px;
        flex: 1 1 140px;
      }

      .filter-label {
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: #6b7280;
      }

      .filter-select,
      .filter-input {
        padding: 6px 8px;
        border-radius: 8px;
        border: 1px solid #d1d5db;
        font-size: 0.875rem;
        outline: none;
        background-color: #f9fafb;
      }

      .filter-select:focus,
      .filter-input:focus {
        border-color: #2563eb;
        box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.3);
        background-color: #ffffff;
      }

      .filter-checkbox {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 0.8rem;
        color: #4b5563;
        margin-top: 20px;
      }

      .stats {
        font-size: 0.8rem;
        color: #6b7280;
        margin-bottom: 8px;
      }

      .cards-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 12px;
      }

      .player-card {
        background-color: #ffffff;
        border-radius: 12px;
        padding: 12px;
        display: flex;
        gap: 10px;
        align-items: center;
        box-shadow: 0 1px 3px rgba(15, 23, 42, 0.08);
      }

      .player-avatar {
        width: 76px;
        height: 76px;
        border-radius: 9999px;
        overflow: hidden;
        flex-shrink: 0;
        background-color: #e5e7eb;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        color: #4b5563;
        font-size: 1.2rem;
      }

      .player-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .player-main {
        display: flex;
        flex-direction: column;
        gap: 4px;
        flex: 1;
        min-width: 0;
      }

      .player-name {
        font-size: 1rem;
        font-weight: 600;
        margin: 0;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .player-sub {
        font-size: 0.8rem;
        color: #6b7280;
        margin: 0;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .player-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 4px;
        margin-top: 4px;
      }

      .badge {
        font-size: 0.7rem;
        padding: 2px 6px;
        border-radius: 9999px;
        background-color: #e5e7eb;
        color: #374151;
        font-weight: 500;
      }

      .badge-skill-BEGINNER {
        background-color: #fee2e2;
        color: #b91c1c;
      }

      .badge-skill-BASIC {
        background-color: #e0f2fe;
        color: #0369a1;
      }

      .badge-skill-INTERMEDIATE {
        background-color: #dcfce7;
        color: #166534;
      }

      .badge-skill-ADVANCED {
        background-color: #fef3c7;
        color: #92400e;
      }

      .badge-age {
        background-color: #e5e7eb;
        color: #374151;
      }

      .empty-state {
        font-size: 0.9rem;
        color: #6b7280;
        padding: 24px;
        text-align: center;
        background-color: #ffffff;
        border-radius: 12px;
        box-shadow: 0 1px 3px rgba(15, 23, 42, 0.08);
      }

      @media (max-width: 640px) {
        .filters {
          padding: 10px;
        }
        .player-card {
          padding: 10px;
        }
      }
    </style>
  </head>
  <body>
    <div class="page">
      <section class="header">
        <h1 class="title">Senarai Pemain BTB Putrajaya 2025</h1>
        <p class="subtitle">Data langsung dari Google Form & Google Sheets (auto update bila parent submit).</p>
      </section>

      <section class="filters">
        <div class="filter-group">
          <span class="filter-label">Tahap Penguasaan</span>
          <select id="skillLevel" class="filter-select">
            <option value="">Semua</option>
          </select>
        </div>

        <div class="filter-group">
          <span class="filter-label">Umur</span>
          <select id="ageFilter" class="filter-select">
            <option value="">Semua</option>
          </select>
        </div>

        <div class="filter-group">
          <span class="filter-label">Cari Nama / Ibu Bapa</span>
          <input
            id="searchText"
            class="filter-input"
            type="text"
            placeholder="Contoh: Shaqeel / Shahrul"
          />
        </div>

        <div class="filter-group" style="min-width: 180px; flex: 0 0 auto;">
          <label class="filter-checkbox">
            <input type="checkbox" id="hasPhoto" />
            Hanya pemain yang ada gambar
          </label>
        </div>
      </section>

      <div class="stats" id="statsText"></div>
      <section id="playerCards" class="cards-grid"></section>
    </div>

    <script>
      // Google Sheets gviz JSON endpoint for "Form Responses 1"
      const SHEET_URL =
        'https://docs.google.com/spreadsheets/d/1mgZ0z9USOKBI8nZsJ_Wbuq3h3VSNYW2vxIc0boj4HW0/gviz/tq?tqx=out:json&sheet=Form%20Responses%201';

      let allData = [];

      function transformImageUrl(rawUrl) {
        if (!rawUrl) return '';
        const idParamMatch = rawUrl.match(/[?&]id=([^&]+)/);
        const pathMatch = rawUrl.match(/\/d\/([-\w]{10,})/);
        const fileId = idParamMatch ? idParamMatch[1] : pathMatch ? pathMatch[1] : null;
        if (!fileId) return rawUrl;
        return 'https://drive.google.com/uc?export=view&id=' + fileId;
      }

      function loadData() {
        fetch(SHEET_URL)
          .then((res) => res.text())
          .then((text) => {
            const json = JSON.parse(text.substring(text.indexOf('{')));
            const rows = json.table.rows || [];

            allData = rows.map((r) => {
              const c = r.c || [];
              const ageRaw = c[3] && c[3].v != null ? String(c[3].v) : '';
              return {
                timestamp: c[0]?.v || '',
                email: c[1]?.v || '',
                name: c[2]?.v || '',
                age: ageRaw,
                parentName: c[4]?.v || '',
                parentPhone: c[5]?.v || '',
                address: c[6]?.v || '',
                school: c[7]?.v || '',
                skillLevel: c[8]?.v || '',
                achievement: c[9]?.v || '',
                parentConsent: c[10]?.v || '',
                imageUrl: transformImageUrl(c[11]?.v || '')
              };
            });

            populateFilters(allData);
            renderCards(allData);
          })
          .catch((err) => {
            console.error('Error load sheet:', err);
            document.getElementById('playerCards').innerHTML =
              '<div class="empty-state">Ralat memuat data: ' + err + '</div>';
          });
      }

      function populateFilters(data) {
        const skillSelect = document.getElementById('skillLevel');
        const ageSelect = document.getElementById('ageFilter');
        const skillSet = new Set();
        const ageSet = new Set();

        data.forEach((p) => {
          if (p.skillLevel) skillSet.add(p.skillLevel);
          if (p.age) ageSet.add(p.age);
        });

        [...skillSet]
          .sort()
          .forEach((level) => {
            const opt = document.createElement('option');
            opt.value = level;
            opt.textContent = level;
            skillSelect.appendChild(opt);
          });

        [...ageSet]
          .sort((a, b) => {
            const na = parseInt(a, 10);
            const nb = parseInt(b, 10);
            if (isNaN(na) || isNaN(nb)) return String(a).localeCompare(String(b));
            return na - nb;
          })
          .forEach((age) => {
            const opt = document.createElement('option');
            opt.value = age;
            opt.textContent = age.toString().includes('tahun') ? age : age + ' tahun';
            ageSelect.appendChild(opt);
          });
      }

      function renderCards(data) {
        const container = document.getElementById('playerCards');
        const statsText = document.getElementById('statsText');
        container.innerHTML = '';

        if (!data || data.length === 0) {
          statsText.textContent = '0 pemain dijumpai untuk filter semasa.';
          container.innerHTML =
            '<div class="empty-state">Tiada pemain sepadan dengan filter yang dipilih.</div>';
          return;
        }

        statsText.textContent = data.length + ' pemain dipaparkan.';

        data.forEach((player) => {
          const card = document.createElement('div');
          card.className = 'player-card';

          const avatar = document.createElement('div');
          avatar.className = 'player-avatar';

          if (player.imageUrl) {
            const img = document.createElement('img');
            img.src = player.imageUrl;
            img.alt = player.name || 'Pemain';
            avatar.appendChild(img);
          } else {
            const initials = (player.name || '')
              .split(' ')
              .filter((p) => p)
              .slice(0, 2)
              .map((p) => p[0].toUpperCase())
              .join('');
            avatar.textContent = initials || '?';
          }

          const main = document.createElement('div');
          main.className = 'player-main';

          const nameEl = document.createElement('h3');
          nameEl.className = 'player-name';
          nameEl.textContent = player.name || '-';

          const subEl = document.createElement('p');
          subEl.className = 'player-sub';
          subEl.textContent = (player.school || '-') + ' â€¢ ' + (player.parentName || '-');

          const meta = document.createElement('div');
          meta.className = 'player-meta';

          const ageBadge = document.createElement('span');
          ageBadge.className = 'badge badge-age';
          ageBadge.textContent = player.age ? player.age.toString() + '' : '-';
          meta.appendChild(ageBadge);

          if (player.skillLevel) {
            const skillBadge = document.createElement('span');
            const skillClass = 'badge-skill-' + String(player.skillLevel).toUpperCase();
            skillBadge.className = 'badge ' + skillClass;
            skillBadge.textContent = player.skillLevel;
            meta.appendChild(skillBadge);
          }

          if (player.achievement) {
            const achBadge = document.createElement('span');
            achBadge.className = 'badge';
            achBadge.textContent = player.achievement;
            meta.appendChild(achBadge);
          }

          main.appendChild(nameEl);
          main.appendChild(subEl);
          main.appendChild(meta);

          card.appendChild(avatar);
          card.appendChild(main);

          container.appendChild(card);
        });
      }

      function applyFilters() {
        const skillLevel = document.getElementById('skillLevel').value;
        const ageFilter = document.getElementById('ageFilter').value;
        const searchText = document.getElementById('searchText').value.toLowerCase();
        const hasPhoto = document.getElementById('hasPhoto').checked;

        const filtered = allData.filter((p) => {
          if (skillLevel && p.skillLevel !== skillLevel) return false;
          if (ageFilter && String(p.age) !== ageFilter) return false;
          if (hasPhoto && !p.imageUrl) return false;
          if (searchText) {
            const name = (p.name || '').toLowerCase();
            const parent = (p.parentName || '').toLowerCase();
            if (!name.includes(searchText) && !parent.includes(searchText)) return false;
          }
          return true;
        });

        renderCards(filtered);
      }

      document.getElementById('skillLevel').addEventListener('change', applyFilters);
      document.getElementById('ageFilter').addEventListener('change', applyFilters);
      document.getElementById('searchText').addEventListener('input', applyFilters);
      document.getElementById('hasPhoto').addEventListener('change', applyFilters);

      window.addEventListener('DOMContentLoaded', loadData);
    </script>
  </body>
</html>


